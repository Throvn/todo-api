
  <!DOCTYPE html>
  <html>
    <head>
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <style>
        body {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        main {
            flex: 1 0 auto;
        }
      </style>
    </head>

    <body>
        
        <div class="navbar-fixed">
                <nav> TodoHuhu <a href="#" data-target="slide-out" style="display: block;" class="sidenav-trigger"><i class="material-icons">menu</i></a> </nav>
        </div>

  <ul id="slide-out" class="sidenav">
        <div class="nav-wrapper">
                <form>
                  <div class="input-field">
                    <input id="autocomplete-input" class="autocomplete" type="search" placeholder="Search Todos" required>
                    <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                    <i class="material-icons">close</i>
                  </div>
                </form>
              </div>
    <li><a href="#!"><i class="material-icons">note_add</i>Add a Todo</a></li>
    <li><a href="#!"><i class="material-icons">note</i>Get all Todos</a></li>
    <li><div class="divider"></div></li>
    <li><a class="subheader">Subheader</a></li>
    <li><a class="waves-effect" href="#!">Third Link With Waves</a></li>
  </ul>
         
        <div class="container">    
            <div class="row" id="todos">

            </div>
            <div class="fixed-action-btn">
                <a class="btn-floating btn-large red">
                <i class="large material-icons">mode_edit</i>
                </a>
                <ul>
                <li><a class="btn-floating red"><i class="material-icons">insert_chart</i></a></li>
                <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li>
                <li><a class="btn-floating green"><i class="material-icons">publish</i></a></li>
                <li><a class="btn-floating blue"><i class="material-icons">attach_file</i></a></li>
                </ul>
            </div>
        </div>
        <footer class="page-footer">
                <div class="container">
                  <div class="row">
                    <div class="col l6 s12">
                      <h5 class="white-text">Footer Content</h5>
                      <p class="grey-text text-lighten-4">You can use rows and columns here to organize your footer content.</p>
                    </div>
                    <div class="col l4 offset-l2 s12">
                      <h5 class="white-text">Links</h5>
                      <ul>
                        <li><a class="grey-text text-lighten-3" href="#!">Link 1</a></li>
                        <li><a class="grey-text text-lighten-3" href="#!">Link 2</a></li>
                        <li><a class="grey-text text-lighten-3" href="#!">Link 3</a></li>
                        <li><a class="grey-text text-lighten-3" href="#!">Link 4</a></li>
                      </ul>
                    </div>
                  </div>
                </div>
                <div class="footer-copyright">
                  <div class="container">
                  Â© 2019 Copyright Text
                  <a class="grey-text text-lighten-4 right" href="#!">More Links</a>
                  </div>
                </div>
              </footer>

                <!-- Modal Structure -->
                <div id="modal1" class="modal">
                  <div class="modal-content">
                    <div class="row">
                      <div class="col s9">
                          <h4>Todo Details</h4>
                      </div>
                      <div class="col s3 right-align" id="completedAt">
                          completedAt
                      </div>
                    </div>
                    <div class="row">
                      <div class="col s8">
                          <h5 id="todo-text">Loading</h5>
                      </div>
                      <div class="col s4">
                          <table class="responsive-table">
                              <tbody>
                                <tr>
                                  <th>
                                    __v
                                  </th>
                                  <td id="__v">
                                    0
                                  </td>
                                </tr>
                                <tr>
                                    <th>
                                      _id
                                    </th>
                                    <td id="_id">
                                      loading
                                    </td>
                                  </tr>
                                  <tr>
                                      <th>
                                        Completed
                                      </th>
                                      <td id="completed">
                                        loading
                                      </td>
                                    </tr>
                              </tbody>
                            </table>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <a href="#!" class="modal-close waves-effect waves-green btn-flat">Agree</a>
                  </div>
                </div>
                        
      <!--JavaScript at end of body for optimized loading-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      <script>

            $(document).ready(function(){
                $('.sidenav').sidenav();
            });
            $(document).ready(function(){
                $('.fixed-action-btn').floatingActionButton();
            });
            $(document).ready(function(){
              $('.modal').modal();
            });

            function toggleCompleted(el) {
              
              if($(el).hasClass('red')){
                $(el).removeClass('red')
                $(el).addClass('green')
              } else {
                $(el).removeClass('green')
                $(el).addClass('red')

              }
            }
      </script>
      <script>
          let data, color;
        var getJSON = function(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
            var status = xhr.status;
            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status, xhr.response);
            }
            };
            xhr.send();
        }
        var postJSON = function(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
            var status = xhr.status;
            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status, xhr.response);
            }
            };
            xhr.send();
        }
        var deleteJSON = function(url, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('DELETE', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
            var status = xhr.status;
            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status, xhr.response);
            }
            };
            xhr.send();
        }
        var patchJSON = function(url, data, callback) {
            var xhr = new XMLHttpRequest();
            xhr.open('PATCH', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
            var status = xhr.status;
            if (status === 200) {
                callback(null, xhr.response);
            } else {
                callback(status, xhr.response);
            }
            };
            xhr.send(data);
        }
        getJSON('https://lit-garden-95717.herokuapp.com/todos', function (status,response) {
            data = response.todos;  
            data.forEach(element => {
              if (element.completed) {
                color = 'green'
                patchJSON('https://lit-garden-95717.herokuapp.com/todos/', {completed: true}, function (status, response) {
                  console.log(response);
                  
                })
              } else {
                color = 'red'
                patchJSON('https://lit-garden-95717.herokuapp.com/todos/', {completed: true}, function (status, response) {
                  console.log(response);
                  
                })
              }
                $('#todos').append('<div class="col offset-s2 s8"> <div class="card hoverable"> <div class="card-content"> <p>'+element.text+'</p></div><div class="card-action"> <div class="row m0"> <div class="col m6 s6"> <a class="waves-effect waves-light btn show-todo" href="#modal1" id="'+element._id+'">Details</a> <a onclick="toggleCompleted(this)" class="waves-effect waves-light btn '+color+'">Completed</a> </div><div class="col m6 s6 "><a class="delete-todo" id="'+element._id+'"><p class="right-align"><i class="material-icons">delete</i></p></a></div></div></div></div></div>')
            });
            $('.show-todo').on('click', (e) => {
              
              getJSON('https://lit-garden-95717.herokuapp.com/todos/'+e.currentTarget.id, function (status, response) {
                $('#todo-text').text(response.text)
                $('#__v').text(response.__v)
                $('#_id').text(response._id)
                $('#completed').text(response.completed)
                $('#completedAt').text(moment(response.completedAt).fromNow())
                var instance = M.Modal.getInstance(document.getElementById('modal1'));
                instance.open()
              })
              
              
            })
        })

      </script>
    </body>
  </html>